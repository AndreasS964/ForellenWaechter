# ğŸ“¡ ForellenWÃ¤chter v1.4 - LTE Remote Edition

VollstÃ¤ndige Anleitung fÃ¼r die LTE-Version mit Remote-Zugriff und E-Mail-Alarmen.

---

## ğŸ†• Neu in Version 1.4

| Feature | Beschreibung |
|---------|--------------|
| ğŸ“¡ **LTE/4G Mobilfunk** | Remote-Zugriff von Ã¼berall |
| ğŸ“§ **E-Mail Alarme** | Sofortige Benachrichtigung bei Problemen |
| ğŸ«§ **DO-Sensor Support** | Dissolved Oxygen (Sauerstoff) optional |
| ğŸ¨ **Neues Dashboard** | Modernes Glassmorphism-Design |
| â° **Echtzeit-Uhr** | NTP-Synchronisation Ã¼ber Internet |
| ğŸ“Š **Erweiterte API** | Mehr Endpunkte, Settings-POST |

---

## ğŸ”Œ Hardware v1.4

### Neue Komponenten

| Komponente | Beschreibung | Bezugsquelle |
|------------|--------------|--------------|
| LILYGO T-SIM7600E | ESP32 mit LTE-Modul integriert | AliExpress |
| **ODER** SIM7600E Modul | Separates LTE-Modul | Amazon |
| SIM-Karte | Daten-SIM mit min. 100MB/Monat | Mobilfunkanbieter |
| DFRobot Gravity DO | Dissolved Oxygen Sensor (optional) | DFRobot Shop |
| Externe Antenne | LTE Antenne (empfohlen fÃ¼r Wald) | Amazon |

### Pin-Belegung v1.4

```
ESP32 GPIO    Funktion
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GPIO 4        DS18B20 OneWire Bus
GPIO 34       pH-Sensor (ADC)
GPIO 35       TDS-Sensor (ADC)
GPIO 32       DO-Sensor (ADC) - NEU!
GPIO 33       Float Switch

GPIO 26       Relais 1 - BelÃ¼ftung
GPIO 27       Relais 2 - Alarm
GPIO 14       Relais 3 - Reserve
GPIO 12       Relais 4 - Reserve

GPIO 2        Status LED (blau)
GPIO 13       Alarm LED (rot) - NEU!
GPIO 15       Buzzer

GPIO 5        SD-Karte CS
GPIO 23       SD-Karte MOSI
GPIO 19       SD-Karte MISO
GPIO 18       SD-Karte SCK

GPIO 17       LTE TX (SIM7600)
GPIO 16       LTE RX (SIM7600)
```

---

## ğŸ“± LTE Einrichtung

### 1. SIM-Karte vorbereiten

- **Empfehlung:** IoT/M2M SIM-Karte
- **Datenvolumen:** Min. 100MB/Monat (reicht fÃ¼r Monitoring)
- **PIN deaktivieren!** (wichtig)

Provider-Empfehlungen (DE):
- **1NCE:** Einmalig, 500MB fÃ¼r 10 Jahre
- **Telekom IoT:** Monatliche Tarife
- **Congstar Prepaid:** Flexibel

### 2. APN konfigurieren

```cpp
// Im Code anpassen:
#define LTE_APN "internet"       // Telekom
// #define LTE_APN "web.vodafone.de"  // Vodafone
// #define LTE_APN "internet.t-mobile" // T-Mobile
// #define LTE_APN "pinternet.interkom.de" // O2
```

### 3. LILYGO T-SIM7600E Board

Falls du das integrierte Board verwendest:

```cpp
// Pin-Definitionen fÃ¼r LILYGO T-SIM7600E:
#define LTE_TX 27
#define LTE_RX 26
#define LTE_PWR 4
#define LTE_RST 5
#define LTE_DTR 32
```

### 4. Verbindung testen

Nach Upload â†’ Serial Monitor:
```
ğŸ“¡ LTE wird initialisiert...
   Modul: SIMCOM SIM7600E
âœ… LTE verbunden!
   Operator: Telekom.de
   Signal: 18/31
```

---

## ğŸ“§ E-Mail Alarme einrichten

### Option 1: IFTTT Webhook (Empfohlen)

1. **IFTTT Account erstellen:** https://ifttt.com
2. **Neues Applet erstellen:**
   - IF: Webhooks â†’ "Receive a web request"
   - Event Name: `forellen_alarm`
   - THEN: Email â†’ "Send me an email"
3. **Webhook URL kopieren:**
   - Gehe zu: https://ifttt.com/maker_webhooks
   - "Documentation" klicken
   - URL kopieren

4. **Im Code eintragen:**
```cpp
const char* EMAIL_WEBHOOK_URL = "https://maker.ifttt.com/trigger/forellen_alarm/with/key/DEIN_KEY";
```

### Option 2: Eigener Server

Falls du einen eigenen Webhook-Server hast:

```cpp
const char* EMAIL_WEBHOOK_URL = "https://dein-server.de/api/forellen-alert";
```

Der Server sollte JSON empfangen:
```json
{
  "value1": "ğŸš¨ ForellenWÃ¤chter ALARM",
  "value2": "Temperatur KRITISCH: 16.5Â°C\n...",
  "value3": "2024-12-01 14:30:00"
}
```

### E-Mail Einstellungen

```cpp
const char* EMAIL_RECIPIENT = "your-email@example.com";  // Ã„NDERN!
#define EMAIL_COOLDOWN_MIN 30  // Min. 30 Minuten zwischen E-Mails
```

---

## ğŸ«§ Sauerstoff-Sensor (DO)

### DFRobot Gravity Dissolved Oxygen Sensor

**Aktivierung:**
```cpp
#define ENABLE_DO_SENSOR true
```

**Verkabelung:**
```
DO-Sensor           ESP32
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
VCC          â†’      3.3V
GND          â†’      GND
Signal       â†’      GPIO 32
```

**Kalibrierung (wichtig!):**

1. **Einpunkt-Kalibrierung (Luft):**
   - Sensor-Spitze in die Luft halten (NICHT ins Wasser)
   - Warten bis Wert stabil
   - Spannung notieren (ca. 1.5V bei 20Â°C)
   - Im Code anpassen:
   ```cpp
   const float V_SATURATION = 1.5;  // Dein Wert
   ```

2. **Zweipunkt-Kalibrierung (genauer):**
   - ZusÃ¤tzlich Nullpunkt mit Natriumsulfit-LÃ¶sung

**Grenzwerte fÃ¼r Forellen:**
```cpp
float doMin = 6.0;     // Minimum (Alarm wenn unterschritten)
float doOptimal = 9.0; // Optimal (BelÃ¼ftung aktiviert wenn darunter)
```

---

## ğŸ¨ Neues Dashboard

### Features

- **Glassmorphism Design** - Moderne, durchscheinende UI
- **Echtzeit-Updates** - Alle 2 Sekunden
- **Responsive** - Optimiert fÃ¼r Handy und Desktop
- **Animationen** - Schwimmender Fisch, pulsierende Alarme
- **Dunkles Theme** - Angenehm fÃ¼r die Augen

### Zugriff

- **Lokal:** http://192.168.4.1 oder http://forellenwaechter.local
- **Remote:** Ãœber Ã¶ffentliche IP (wenn Router konfiguriert)

### Screenshots

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸŸ                                    â”‚
â”‚                  FORELLENWÃ„CHTER                             â”‚
â”‚        IoT Monitoring fÃ¼r Aquakultur â€¢ Powered by Wasserkraft âš¡â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â—‹ WiFi: -45 dBm    â—‹ LTE: 18/31    â—‹ Uptime: 2d 5h         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚  ğŸ’§  â”‚ â”‚  ğŸŒ¡ï¸  â”‚ â”‚  ğŸ§ª  â”‚ â”‚  ğŸ“Š  â”‚ â”‚  ğŸ«§  â”‚ â”‚  ğŸŒŠ  â”‚      â”‚
â”‚ â”‚ 11.5 â”‚ â”‚ 18.2 â”‚ â”‚ 7.24 â”‚ â”‚ 185  â”‚ â”‚ 8.5  â”‚ â”‚  OK  â”‚      â”‚
â”‚ â”‚  Â°C  â”‚ â”‚  Â°C  â”‚ â”‚      â”‚ â”‚ ppm  â”‚ â”‚ mg/L â”‚ â”‚      â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ˆ Temperaturverlauf                    [24h] [7d]          â”‚
â”‚ â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®             â”‚
â”‚ â”‚   â”€â”€â”€ Wasser â”€â”€â”€ Luft                       â”‚             â”‚
â”‚ â”‚     â•±â•²      â•±â•²      â•±â•²                     â”‚             â”‚
â”‚ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Konfiguration

### Feature-Toggles

```cpp
#define ENABLE_LTE true           // LTE Mobilfunk
#define ENABLE_WIFI true          // WiFi (parallel zu LTE)
#define ENABLE_EMAIL_ALERTS true  // E-Mail Benachrichtigungen
#define ENABLE_DO_SENSOR false    // Dissolved Oxygen
#define ENABLE_SD_LOGGING true    // SD-Karten Logging
```

### Grenzwerte anpassen

Im Code oder Ã¼ber API:

```cpp
struct TroutParameters {
  float tempMin = 8.0;       // Minimum Wassertemperatur
  float tempMax = 14.0;      // Maximum Wassertemperatur
  float tempCritical = 16.0; // Kritische Temperatur
  float phMin = 6.5;         // Minimum pH
  float phMax = 8.5;         // Maximum pH
  float tdsMax = 500;        // Maximum TDS
  float doMin = 6.0;         // Minimum Sauerstoff
  float doOptimal = 9.0;     // Optimaler Sauerstoff
};
```

Oder per POST:
```bash
curl -X POST http://192.168.4.1/api/settings \
  -H "Content-Type: application/json" \
  -d '{"tempMax": 15.0, "phMin": 6.0}'
```

---

## ğŸ“¡ Remote-Zugriff einrichten

### Option 1: Port-Forwarding (Heimnetz mit Router)

1. Router-Einstellungen Ã¶ffnen
2. Port-Forwarding: Port 80 â†’ ESP32 IP
3. DynDNS einrichten fÃ¼r feste Domain

### Option 2: VPN (sicherer)

- WireGuard auf Raspberry Pi
- Zugriff Ã¼ber VPN-Tunnel

### Option 3: Cloud-Dashboard (zukÃ¼nftig)

- Daten an Cloud senden
- Dashboard Ã¼berall verfÃ¼gbar
- Geplant fÃ¼r v1.5

---

## ğŸ“Š API v1.4

### Neue Endpunkte

| Endpunkt | Methode | Beschreibung |
|----------|---------|--------------|
| `/api/sensors` | GET | Alle Sensorwerte inkl. DO |
| `/api/status` | GET | System + LTE Status |
| `/api/settings` | GET | Aktuelle Grenzwerte |
| `/api/settings` | POST | Grenzwerte Ã¤ndern |
| `/api/test-email` | POST | Test-E-Mail senden |

### Beispiel: Status

```bash
curl http://192.168.4.1/api/status
```

```json
{
  "uptime": 86400,
  "freeHeap": 180000,
  "wifiConnected": true,
  "wifiRSSI": -45,
  "lteConnected": true,
  "lteSignal": 18,
  "lteOperator": "Telekom.de",
  "publicIP": "93.xxx.xxx.xxx",
  "sdCard": true,
  "alarmCount": 3,
  "dailyAlarms": 1,
  "firmware": "1.4.0"
}
```

---

## ğŸ› Troubleshooting LTE

### LTE verbindet nicht

1. **SIM-PIN deaktiviert?**
   - SIM in Handy testen
   - PIN in Handy-Einstellungen ausschalten

2. **APN korrekt?**
   - Provider-APN prÃ¼fen
   - Im Code anpassen

3. **Antenne angeschlossen?**
   - Externe Antenne verwenden
   - Position optimieren (Fenster)

4. **Signal zu schwach?**
   - CSQ < 10 = problematisch
   - Antenne mit Kabel verlÃ¤ngern

### E-Mail kommt nicht an

1. **Webhook-URL korrekt?**
   - In Browser testen
   - IFTTT Applet aktiviert?

2. **Internet-Verbindung?**
   - LTE oder WiFi verbunden?
   - `/api/status` prÃ¼fen

3. **Cooldown aktiv?**
   - Standard: 30 Min zwischen E-Mails
   - Im Code anpassen

---

## âš¡ Stromversorgung

Mit Wasserkraft hast du genug Power fÃ¼r 24/7 Betrieb!

**Empfohlene Konfiguration:**
- Wasserkraft-Turbine: 200W
- Laderegler: 12V/24V
- Batterie: 100Ah LiFePO4 (Puffer fÃ¼r Niedrigwasser)
- Step-Down: 12V â†’ 5V fÃ¼r ESP32

**Stromverbrauch v1.4:**
- ESP32 + LTE: ~200mA
- Sensoren: ~50mA
- Relais: ~80mA pro aktives Relais
- **Gesamt:** ~300-500mA (1.5-2.5W)

---

## ğŸ”® Vorbereitungen fÃ¼r v1.5+

Der Code ist bereits vorbereitet fÃ¼r:

- **Multi-Becken:** Slave-GerÃ¤te Ã¼ber ESP-NOW
- **Fischdatenbank:** Artspezifische Parameter
- **Cloud-Integration:** MQTT Support
- **OTA Updates:** Over-the-Air Firmware-Updates

Siehe [ROADMAP.md](ROADMAP.md) fÃ¼r Details.
